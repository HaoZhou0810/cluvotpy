# cluvotpy
A project to extract cleaned UVOT UV **nominal** spectra
---
This script is based on the [_uvotpy_](https://github.com/PaulKuin/uvotpy), so make sure _uvotpy_ is installed. This code has been tested in Python 3.10, so in principle, a higher version of Python is also able to run the code.

> Other modules required:
>
> astropy
>
> scipy
>
> iminuit
>
> matplotlib
>
> numpy

---

> _cluvotpy.py_ contains the Python class to extract the cleaned spectrum.
>
> _â€Žswugu0200_ax1080ay1000_dx100dy100_o2_20041120v001_cl.arf_ is the calibrated second order effective area file, please copy it to your caldb folder of _uvotpy_.

Before running the code, please open cluvotpy.py, and change the change the CALDB of uvotpy package at Line 24. Then run
```
python.exe cluvotpy.py
```
in your terminal to check if everything is OK (please refer to ./example/README.MD).

I assume you want to use the CleanExtractor class in your own script, so you may need to copy the cluvotpy.py to the search path of your Python.

```
from cluvotpy import *
cl_extractor = CleanExtractor('uvotpy_extracted_spectrum.pha')
cl_extractor.print_par()
cl_extractor.extract_cl_spec()
cl_extractor.write_cl_spec()
```

- .print_par() prints key parameters on your terminal. Please pay attention to the "Distance of 1st anchor from the ref position", if the value is greater than 150, the cleaned spectrum could be unreliable. No input paramter.

- .extract_cl_spec() runs the script to extract the cleaned spectrum. No input parameter.

- .write_cl_spec() writes the cleaned spectrum to the same folder of the input xxx.pha as xxx_cl.pha. No input parameter. The cleaned spectrum is saved in the CALSPEC extension with 3 columns: CL_FLUX, CL_FLUX_ERR and CL_QUALITY. CL_QUALITY == 1 means this wavelength is beyond the valid wavelength of UV nominal mode (1700~5000 AA). CL_QUALITY == 0 means the data is good.

Or, you can just modify codes after Line 674 of _cluvotpy.py_, i.e., change the working directory and the input .pha file generated by _uvotpy_.
```
os.chdir(os.path.split(__file__)[0])
cl_extractor = CleanExtractor('example/sw00554620000ugu_1ord_1_f.pha')
cl_extractor.print_par()
cl_extractor.extract_cl_spec()
cl_extractor.write_cl_spec()
cl_extractor.plot_spec(np.linspace(1700, 5000, 133))
# plt.savefig('cl_spec.png', bbox_inches='tight')
plt.show()
exit()
```
- .plot_spec() plots the 2d, raw and cleaned spectra, it can be saved if you want. The only input parameter is the EDGE of the wave length bin.

---
Note: This package is planned to be merged into the [_uvotpy_](https://github.com/PaulKuin/uvotpy) in the near future.
